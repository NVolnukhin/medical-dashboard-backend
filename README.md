# Medical Dashboard Backend

Тут будет описание что это такое и с чем едят

### Стек технологий для бэкэнда

- .NET / C# 8.0
- БД - PostgreSQL
- Брокер сообщений - Kafka
- SignalR - для передачи данных в реал-тайме
- Docker - для развертывания

### Структура проекта
```
backend
├─── MedicalDashboard
│    ├── DataCollectorService
│    ├── DataAnalysisService
│    ├── NotificationService
│    ├── DashboardAPI
│    ├── AuthService
│    ├── Gateway
│    ├── SharedContracts
│    ├── MedicalDashboard.sln
│    └── docker-compose.yml
├──── .gitignore
└──── README.md
```

### Компоненты системы

| Сервис                     | Описание                                                                                                                                                                                                                                         | Основные функции                                                                                                           | Примечания                                                                                          |
|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| **DataCollectorService (DCS)** | Сервис для генерации и сбора данных. Генерирует «информацию с приборов» и записывает её в Kafka в топик `raw-information`. Имеет собственный цикл обновлений, поддерживает масштабирование. Отделяет сбор телеметрии от её обработки.            | - Генерация данных с приборов.<br>- Публикация данных в топик `raw-information`.                                           | Изолирован для независимости от других процессов.                                                    |
| **DataAnalysisService (DAS)**  | Сервис анализа данных. Подписан на топик `raw-information`. Анализирует поступающие данные и при обнаружении аномалий публикует тревоги в топик `alerts`.                                                                                        | - Анализ телеметрии.<br>- Обнаружение аномалий.<br>- Публикация тревог в топик `alerts`.                                   | Изолирован, чтобы обработка данных не влияла на сбор или другие процессы.                            |
| **NotificationService (NS)**   | Сервис уведомлений. Подписан на топики `email` и `alerts`. Отправляет служебные письма (регистрация, смена пароля) и уведомления о тревогах медсёстрам и прикреплённым врачам. Использует сторонние каналы (SMTP, push, возможно SMS в будущем). | - Отправка служебных писем.<br>- Уведомления о тревогах.<br>- Интеграция с SMTP, push-уведомлениями.                       | Изолирован, чтобы сбои внешних каналов (например, SMTP) не влияли на работу системы.                 |
| **AuthService (AS)**           | Сервис аутентификации и авторизации. Для админов: регистрация докторов/медсестёр, управление ролями. Для пользователей: авторизация (JWT или JWT+access). Централизованное управление политиками безопасности.                                   | - Регистрация и управление ролями.<br>- Аутентификация пользователей.<br>- Валидация токенов для других микросервисов.     | Централизованное управление безопасностью, возможно расширение для валидации токенов.                |
| **DashboardAPI**               | Основной сервис для взаимодействия с фронтендом. Предоставляет CRUD-операции для работы с пациентами, аппаратами, графиками. Поддерживает роли (админ, доктор, медсестра). Просмотр уведомлений.                                                 | - CRUD для пациентов и аппаратов.<br>- Генерация графиков.<br>- Просмотр уведомлений.<br>- Разграничение доступа по ролям. | Отделён для разделения REST-логики от телеметрии и анализа. Возможна интеграция с AuthService.        |
| **Gateway**                    | Шлюз для объединения всех эндпоинтов на одном порту (DashboardAPI, AuthService). Упрощает интеграцию с фронтендом, предоставляя единый BaseUrl. Реализован через Ocelot (не полноценный микросервис).                                            | - Объединение эндпоинтов.<br>- Упрощение интеграции с фронтендом.<br>- Перенаправление запросов через Ocelot.              | Не требует сложной реализации, достаточно базовой конфигурации Ocelot.                               |
| **SharedContracts**            | Библиотека для моделей, которые используются в различных микросервисах                                                                                                                                                                           | - Позволяет избежать дублирования кода. <br>- Упрощает поддержку микросервисов                                             |

### Обоснование архитектурного подхода

Микросервисная архитектура выбрана для проекта по следующим причинам:

1. **Масштабируемость**
    - Сервисы **DCS** и **DAS** могут потребовать значительных вычислительных ресурсов для обработки больших объёмов данных или сложной аналитики. Микросервисная архитектура позволяет масштабировать каждый сервис горизонтально независимо от других.
    - Возможность переписать **DataAnalysisService** на Python с использованием ML для более сложной аналитики (например, выявление скрытых аномалий) без влияния на другие компоненты.

2. **Разделение ответственности**
    - Каждый сервис выполняет строго определённую функцию, что упрощает разработку, тестирование и поддержку.
    - Изоляция сервисов, таких как **NotificationService**, позволяет минимизировать влияние сбоев внешних интеграций (SMTP, push-уведомления) на общую систему.

3. **Отказоустойчивость**
    - Сбой одного сервиса (например, **DataAnalysisService** или **NotificationService**) не приводит к падению **DashboardAPI** или других критических компонентов.
    - Возможность независимого обновления и перезапуска микросервисов без остановки всей системы.

4. **Гибкость и развитие**
    - Разделение сервисов позволяет использовать разные технологии для реализации (например, **DataAnalysisService** на Python для ML, **DashboardAPI** на .NET для REST).
    - Упрощённое добавление новых функций, таких как поддержка SMS в **NotificationService**, без изменения других компонентов.